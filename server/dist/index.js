!function(e,t){for(var s in t)e[s]=t[s];t.__esModule&&Object.defineProperty(e,"__esModule",{value:!0})}(exports,(()=>{var e={1712:e=>{const t=Object.create(null);t.open="0",t.close="1",t.ping="2",t.pong="3",t.message="4",t.upgrade="5",t.noop="6";const s=Object.create(null);Object.keys(t).forEach((e=>{s[t[e]]=e})),e.exports={PACKET_TYPES:t,PACKET_TYPES_REVERSE:s,ERROR_PACKET:{type:"error",data:"parser error"}}},4050:(e,t,s)=>{const{PACKET_TYPES_REVERSE:r,ERROR_PACKET:n}=s(1712),i=(e,t)=>{const s=Buffer.isBuffer(e);switch(t){case"arraybuffer":return s?o(e):e;case"nodebuffer":default:return e}},o=e=>{const t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0;t<e.length;t++)s[t]=e[t];return t};e.exports=(e,t)=>{if("string"!=typeof e)return{type:"message",data:i(e,t)};const s=e.charAt(0);if("b"===s){const s=Buffer.from(e.substring(1),"base64");return{type:"message",data:i(s,t)}}return r[s]?e.length>1?{type:r[s],data:e.substring(1)}:{type:r[s]}:n}},7559:(e,t,s)=>{const{PACKET_TYPES:r}=s(1712);e.exports=({type:e,data:t},s,n)=>{if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){return n(((e,t)=>t?e:"b"+e.toString("base64"))((e=>Buffer.isBuffer(e)?e:e instanceof ArrayBuffer?Buffer.from(e):Buffer.from(e.buffer,e.byteOffset,e.byteLength))(t),s))}return n(r[e]+(t||""))}},9743:(e,t,s)=>{const r=s(7559),n=s(4050),i=String.fromCharCode(30);e.exports={protocol:4,encodePacket:r,encodePayload:(e,t)=>{const s=e.length,n=new Array(s);let o=0;e.forEach(((e,a)=>{r(e,!1,(e=>{n[a]=e,++o===s&&t(n.join(i))}))}))},decodePacket:n,decodePayload:(e,t)=>{const s=e.split(i),r=[];for(let e=0;e<s.length;e++){const i=n(s[e],t);if(r.push(i),"error"===i.type)break}return r}}},2731:(e,t,s)=>{const r=s(8605),n=s(8053);function i(e,t){const s=new n(t);return s.attach(e,t),s}(t=e.exports=function(){return arguments.length&&arguments[0]instanceof r.Server?i.apply(this,arguments):new n(arguments)}).protocol=1,t.Server=n,t.Socket=s(6539),t.Transport=s(4214),t.transports=s(43),t.parser=s(9743),t.listen=function(e,s,n){"function"==typeof s&&(n=s,s={});const i=r.createServer((function(e,t){t.writeHead(501),t.end("Not Implemented")})),o=t.attach(i,s);return o.httpServer=i,i.listen(e,n),o},t.attach=i},8053:(e,t,s)=>{const r=s(1191),n=s(8835).parse,i=s(8209),o=s(43),a=s(8614).EventEmitter,c=s(6539),h=s(3682)("engine"),u=s(8883);class l extends a{constructor(e={}){super(),this.clients={},this.clientsCount=0,this.opts=Object.assign({wsEngine:process.env.EIO_WS_ENGINE||"ws",pingTimeout:5e3,pingInterval:25e3,upgradeTimeout:1e4,maxHttpBufferSize:1e6,transports:Object.keys(o),allowUpgrades:!0,httpCompression:{threshold:1024},cors:!1},e),e.cookie&&(this.opts.cookie=Object.assign({name:"io",path:"/",httpOnly:!1!==e.cookie.path,sameSite:"lax"},e.cookie)),this.opts.cors&&(this.corsMiddleware=s(479)(this.opts.cors)),e.perMessageDeflate&&(this.opts.perMessageDeflate=Object.assign({threshold:1024},e.perMessageDeflate)),this.init()}init(){if(!~this.opts.transports.indexOf("websocket"))return;this.ws&&this.ws.close();const e="ws"===this.opts.wsEngine?s(2439):s(7854)(this.opts.wsEngine);this.ws=new e.Server({noServer:!0,clientTracking:!1,perMessageDeflate:this.opts.perMessageDeflate,maxPayload:this.opts.maxHttpBufferSize})}upgrades(e){return this.opts.allowUpgrades&&o[e].upgradesTo||[]}verify(e,t,s){const r=e._query.transport;if(!~this.opts.transports.indexOf(r))return h('unknown transport "%s"',r),s(l.errors.UNKNOWN_TRANSPORT,!1);if(function(e){if((e+="").length<1)return!1;if(!p[e.charCodeAt(0)])return h('invalid header, index 0, char "%s"',e.charCodeAt(0)),!0;if(e.length<2)return!1;if(!p[e.charCodeAt(1)])return h('invalid header, index 1, char "%s"',e.charCodeAt(1)),!0;if(e.length<3)return!1;if(!p[e.charCodeAt(2)])return h('invalid header, index 2, char "%s"',e.charCodeAt(2)),!0;if(e.length<4)return!1;if(!p[e.charCodeAt(3)])return h('invalid header, index 3, char "%s"',e.charCodeAt(3)),!0;for(let t=4;t<e.length;++t)if(!p[e.charCodeAt(t)])return h('invalid header, index "%i", char "%s"',t,e.charCodeAt(t)),!0;return!1}(e.headers.origin))return e.headers.origin=null,h("origin header invalid"),s(l.errors.BAD_REQUEST,!1);const n=e._query.sid;return n?this.clients.hasOwnProperty(n)?t||this.clients[n].transport.name===r?void s(null,!0):(h("bad request: unexpected transport without upgrade"),s(l.errors.BAD_REQUEST,!1)):(h('unknown sid "%s"',n),s(l.errors.UNKNOWN_SID,!1)):"GET"!==e.method?s(l.errors.BAD_HANDSHAKE_METHOD,!1):this.opts.allowRequest?this.opts.allowRequest(e,s):s(null,!0)}prepare(e){e._query||(e._query=~e.url.indexOf("?")?r.parse(n(e.url).query):{})}close(){h("closing all open clients");for(let e in this.clients)this.clients.hasOwnProperty(e)&&this.clients[e].close(!0);return this.ws&&(h("closing webSocketServer"),this.ws.close()),this}handleRequest(e,t){h('handling "%s" http request "%s"',e.method,e.url),this.prepare(e),e.res=t;const s=(s,r)=>{r?e._query.sid?(h("setting new request for existing client"),this.clients[e._query.sid].transport.onRequest(e)):this.handshake(e._query.transport,e):d(0,t,s)};this.corsMiddleware?this.corsMiddleware.call(null,e,t,(()=>{this.verify(e,!1,s)})):this.verify(e,!1,s)}generateId(e){return i.generateId()}async handshake(e,t){let s;try{s=await this.generateId(t)}catch(e){return h("error while generating an id"),void d(0,t.res,l.errors.BAD_REQUEST)}h('handshaking client "%s"',s);try{var r=new o[e](t);"polling"===e?(r.maxHttpBufferSize=this.opts.maxHttpBufferSize,r.httpCompression=this.opts.httpCompression):"websocket"===e&&(r.perMessageDeflate=this.opts.perMessageDeflate),t._query&&t._query.b64?r.supportsBinary=!1:r.supportsBinary=!0}catch(s){return h('error handshaking to transport "%s"',e),void d(0,t.res,l.errors.BAD_REQUEST)}const n=new c(s,this,r,t),i=this;this.opts.cookie&&r.on("headers",(e=>{e["Set-Cookie"]=u.serialize(this.opts.cookie.name,s,this.opts.cookie)})),r.onRequest(t),this.clients[s]=n,this.clientsCount++,n.once("close",(function(){delete i.clients[s],i.clientsCount--})),this.emit("connection",n)}handleUpgrade(e,t,s){this.prepare(e);const r=this;this.verify(e,!0,(function(n,i){if(!i)return void function(e,t){if(e.on("error",(()=>{h("ignoring error from closed connection")})),e.writable){const s=l.errorMessages.hasOwnProperty(t)?l.errorMessages[t]:String(t||""),r=Buffer.byteLength(s);e.write("HTTP/1.1 400 Bad Request\r\nConnection: close\r\nContent-type: text/html\r\nContent-Length: "+r+"\r\n\r\n"+s)}e.destroy()}(t,n);const o=Buffer.from(s);s=null,r.ws.handleUpgrade(e,t,o,(function(t){r.onWebSocket(e,t)}))}))}onWebSocket(e,t){if(t.on("error",r),void 0!==o[e._query.transport]&&!o[e._query.transport].prototype.handlesUpgrades)return h("transport doesnt handle upgraded requests"),void t.close();const s=e._query.sid;if(e.websocket=t,s){const n=this.clients[s];if(n)if(n.upgrading)h("transport has already been trying to upgrade"),t.close();else if(n.upgraded)h("transport had already been upgraded"),t.close();else{h("upgrading existing transport"),t.removeListener("error",r);const s=new o[e._query.transport](e);e._query&&e._query.b64?s.supportsBinary=!1:s.supportsBinary=!0,s.perMessageDeflate=this.perMessageDeflate,n.maybeUpgrade(s)}else h("upgrade attempt for closed client"),t.close()}else t.removeListener("error",r),this.handshake(e._query.transport,e);function r(){h("websocket error before upgrade")}}attach(e,t){const s=this;let r=((t=t||{}).path||"/engine.io").replace(/\/$/,"");const n=t.destroyUpgradeTimeout||1e3;function i(e){return r===e.url.substr(0,r.length)}r+="/";const o=e.listeners("request").slice(0);e.removeAllListeners("request"),e.on("close",s.close.bind(s)),e.on("listening",s.init.bind(s)),e.on("request",(function(t,n){if(i(t))h('intercepting request for path "%s"',r),s.handleRequest(t,n);else{let s=0;const r=o.length;for(;s<r;s++)o[s].call(e,t,n)}})),~s.opts.transports.indexOf("websocket")&&e.on("upgrade",(function(e,r,o){i(e)?s.handleUpgrade(e,r,o):!1!==t.destroyUpgrade&&setTimeout((function(){if(r.writable&&r.bytesWritten<=0)return r.end()}),n)}))}}function d(e,t,s){const r={"Content-Type":"application/json"};if(!l.errorMessages.hasOwnProperty(s))return t.writeHead(403,r),void t.end(JSON.stringify({code:l.errors.FORBIDDEN,message:s||l.errorMessages[l.errors.FORBIDDEN]}));void 0!==t&&(t.writeHead(400,r),t.end(JSON.stringify({code:s,message:l.errorMessages[s]})))}l.errors={UNKNOWN_TRANSPORT:0,UNKNOWN_SID:1,BAD_HANDSHAKE_METHOD:2,BAD_REQUEST:3,FORBIDDEN:4},l.errorMessages={0:"Transport unknown",1:"Session ID unknown",2:"Bad handshake method",3:"Bad request",4:"Forbidden"},e.exports=l;const p=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},6539:(e,t,s)=>{const r=s(8614),n=s(3682)("engine:socket");e.exports=class extends r{constructor(e,t,s,r){super(),this.id=e,this.server=t,this.upgrading=!1,this.upgraded=!1,this.readyState="opening",this.writeBuffer=[],this.packetsFn=[],this.sentCallbackFn=[],this.cleanupFn=[],this.request=r,r.websocket&&r.websocket._socket?this.remoteAddress=r.websocket._socket.remoteAddress:this.remoteAddress=r.connection.remoteAddress,this.checkIntervalTimer=null,this.upgradeTimeoutTimer=null,this.pingTimeoutTimer=null,this.pingIntervalTimer=null,this.setTransport(s),this.onOpen()}onOpen(){this.readyState="open",this.transport.sid=this.id,this.sendPacket("open",JSON.stringify({sid:this.id,upgrades:this.getAvailableUpgrades(),pingInterval:this.server.opts.pingInterval,pingTimeout:this.server.opts.pingTimeout})),this.server.opts.initialPacket&&this.sendPacket("message",this.server.opts.initialPacket),this.emit("open"),this.schedulePing()}onPacket(e){if("open"===this.readyState)switch(n("packet"),this.emit("packet",e),this.resetPingTimeout(this.server.opts.pingInterval+this.server.opts.pingTimeout),e.type){case"pong":n("got pong"),this.schedulePing(),this.emit("heartbeat");break;case"error":this.onClose("parse error");break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else n("packet received with closed socket")}onError(e){n("transport error"),this.onClose("transport error",e)}schedulePing(){clearTimeout(this.pingIntervalTimer),this.pingIntervalTimer=setTimeout((()=>{n("writing ping packet - expecting pong within %sms",this.server.opts.pingTimeout),this.sendPacket("ping"),this.resetPingTimeout(this.server.opts.pingTimeout)}),this.server.opts.pingInterval)}resetPingTimeout(e){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=setTimeout((()=>{"closed"!==this.readyState&&this.onClose("ping timeout")}),e)}setTransport(e){const t=this.onError.bind(this),s=this.onPacket.bind(this),r=this.flush.bind(this),n=this.onClose.bind(this,"transport close");this.transport=e,this.transport.once("error",t),this.transport.on("packet",s),this.transport.on("drain",r),this.transport.once("close",n),this.setupSendCallback(),this.cleanupFn.push((function(){e.removeListener("error",t),e.removeListener("packet",s),e.removeListener("drain",r),e.removeListener("close",n)}))}maybeUpgrade(e){n('might upgrade socket transport from "%s" to "%s"',this.transport.name,e.name),this.upgrading=!0;const t=this;function s(s){"ping"===s.type&&"probe"===s.data?(e.send([{type:"pong",data:"probe"}]),t.emit("upgrading",e),clearInterval(t.checkIntervalTimer),t.checkIntervalTimer=setInterval(r,100)):"upgrade"===s.type&&"closed"!==t.readyState?(n("got upgrade packet - upgrading"),i(),t.transport.discard(),t.upgraded=!0,t.clearTransport(),t.setTransport(e),t.emit("upgrade",e),t.schedulePing(),t.flush(),"closing"===t.readyState&&e.close((function(){t.onClose("forced close")}))):(i(),e.close())}function r(){"polling"===t.transport.name&&t.transport.writable&&(n("writing a noop packet to polling for fast upgrade"),t.transport.send([{type:"noop"}]))}function i(){t.upgrading=!1,clearInterval(t.checkIntervalTimer),t.checkIntervalTimer=null,clearTimeout(t.upgradeTimeoutTimer),t.upgradeTimeoutTimer=null,e.removeListener("packet",s),e.removeListener("close",a),e.removeListener("error",o),t.removeListener("close",c)}function o(t){n("client did not complete upgrade - %s",t),i(),e.close(),e=null}function a(){o("transport closed")}function c(){o("socket closed")}t.upgradeTimeoutTimer=setTimeout((function(){n("client did not complete upgrade - closing transport"),i(),"open"===e.readyState&&e.close()}),this.server.opts.upgradeTimeout),e.on("packet",s),e.once("close",a),e.once("error",o),t.once("close",c)}clearTransport(){let e;const t=this.cleanupFn.length;for(let s=0;s<t;s++)e=this.cleanupFn.shift(),e();this.transport.on("error",(function(){n("error triggered by discarded transport")})),this.transport.close(),clearTimeout(this.pingTimeoutTimer)}onClose(e,t){if("closed"!==this.readyState){this.readyState="closed",clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),clearInterval(this.checkIntervalTimer),this.checkIntervalTimer=null,clearTimeout(this.upgradeTimeoutTimer);const s=this;process.nextTick((function(){s.writeBuffer=[]})),this.packetsFn=[],this.sentCallbackFn=[],this.clearTransport(),this.emit("close",e,t)}}setupSendCallback(){const e=this;function t(){if(e.sentCallbackFn.length>0){const t=e.sentCallbackFn.splice(0,1)[0];if("function"==typeof t)n("executing send callback"),t(e.transport);else if(Array.isArray(t)){n("executing batch send callback");const s=t.length;let r=0;for(;r<s;r++)"function"==typeof t[r]&&t[r](e.transport)}}}this.transport.on("drain",t),this.cleanupFn.push((function(){e.transport.removeListener("drain",t)}))}send(e,t,s){return this.sendPacket("message",e,t,s),this}write(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,r){if("function"==typeof s&&(r=s,s=null),(s=s||{}).compress=!1!==s.compress,"closing"!==this.readyState&&"closed"!==this.readyState){n('sending packet "%s" (%s)',e,t);const i={type:e,options:s};t&&(i.data=t),this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.packetsFn.push(r),this.flush()}}flush(){if("closed"!==this.readyState&&this.transport.writable&&this.writeBuffer.length){n("flushing buffer to transport"),this.emit("flush",this.writeBuffer),this.server.emit("flush",this,this.writeBuffer);const e=this.writeBuffer;this.writeBuffer=[],this.transport.supportsFraming?this.sentCallbackFn.push.apply(this.sentCallbackFn,this.packetsFn):this.sentCallbackFn.push(this.packetsFn),this.packetsFn=[],this.transport.send(e),this.emit("drain"),this.server.emit("drain",this)}}getAvailableUpgrades(){const e=[],t=this.server.upgrades(this.transport.name);let s=0;const r=t.length;for(;s<r;++s){const r=t[s];-1!==this.server.opts.transports.indexOf(r)&&e.push(r)}return e}close(e){"open"===this.readyState&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",this.closeTransport.bind(this,e)):this.closeTransport(e))}closeTransport(e){e&&this.transport.discard(),this.transport.close(this.onClose.bind(this,"forced close"))}}},4214:(e,t,s)=>{const r=s(8614),n=s(9743),i=s(3682)("engine:transport");function o(){}e.exports=class extends r{constructor(e){super(),this.readyState="open",this.discarded=!1}discard(){this.discarded=!0}onRequest(e){i("setting request"),this.req=e}close(e){"closed"!==this.readyState&&"closing"!==this.readyState&&(this.readyState="closing",this.doClose(e||o))}onError(e,t){if(this.listeners("error").length){const s=new Error(e);s.type="TransportError",s.description=t,this.emit("error",s)}else i("ignored transport error %s (%s)",e,t)}onPacket(e){this.emit("packet",e)}onData(e){this.onPacket(n.decodePacket(e))}onClose(){this.readyState="closed",this.emit("close")}}},43:(e,t,s)=>{const r=s(4815),n=s(5730);e.exports=t={polling:function(e){return"string"==typeof e._query.j?new n(e):new r(e)},websocket:s(1882)},t.polling.upgradesTo=["websocket"]},5730:(e,t,s)=>{const r=s(4815),n=s(1191),i=/\\\\n/g,o=/(\\)?\\n/g;e.exports=class extends r{constructor(e){super(e),this.head="___eio["+(e._query.j||"").replace(/[^0-9]/g,"")+"](",this.foot=");"}onData(e){"string"==typeof(e=n.parse(e).d)&&(e=e.replace(o,(function(e,t){return t?e:"\n"})),super.onData(e.replace(i,"\\n")))}doWrite(e,t,s){const r=JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");e=this.head+r+this.foot,super.doWrite(e,t,s)}}},4815:(e,t,s)=>{const r=s(4214),n=s(9743),i=s(8761),o=s(9413),a=s(3682)("engine:polling"),c={gzip:i.createGzip,deflate:i.createDeflate};e.exports=class extends r{constructor(e){super(e),this.closeTimeout=3e4,this.maxHttpBufferSize=null,this.httpCompression=null}get name(){return"polling"}onRequest(e){const t=e.res;"GET"===e.method?this.onPollRequest(e,t):"POST"===e.method?this.onDataRequest(e,t):(t.writeHead(500),t.end())}onPollRequest(e,t){if(this.req)return a("request overlap"),this.onError("overlap from client"),t.writeHead(500),void t.end();a("setting request"),this.req=e,this.res=t;const s=this;function r(){s.onError("poll connection closed prematurely")}e.cleanup=function(){e.removeListener("close",r),s.req=s.res=null},e.on("close",r),this.writable=!0,this.emit("drain"),this.writable&&this.shouldClose&&(a("triggering empty send to append close packet"),this.send([{type:"noop"}]))}onDataRequest(e,t){if(this.dataReq)return this.onError("data request overlap from client"),t.writeHead(500),void t.end();this.dataReq=e,this.dataRes=t;let s="";const r=this;function n(){e.removeListener("data",o),e.removeListener("end",a),e.removeListener("close",i),r.dataReq=r.dataRes=s=null}function i(){n(),r.onError("data request connection closed prematurely")}function o(t){let n;s+=t,n=Buffer.byteLength(s),n>r.maxHttpBufferSize&&(s="",e.connection.destroy())}function a(){r.onData(s),t.writeHead(200,r.headers(e,{"Content-Type":"text/html","Content-Length":2})),t.end("ok"),n()}e.on("close",i),e.setEncoding("utf8"),e.on("data",o),e.on("end",a)}onData(e){a('received "%s"',e);const t=this;n.decodePayload(e).forEach((function(e){if("close"===e.type)return a("got xhr close packet"),t.onClose(),!1;t.onPacket(e)}))}onClose(){this.writable&&this.send([{type:"noop"}]),super.onClose()}send(e){this.writable=!1,this.shouldClose&&(a("appending close packet to payload"),e.push({type:"close"}),this.shouldClose(),this.shouldClose=null);const t=this;n.encodePayload(e,(s=>{const r=e.some((function(e){return e.options&&e.options.compress}));t.write(s,{compress:r})}))}write(e,t){a('writing "%s"',e);const s=this;this.doWrite(e,t,(function(){s.req.cleanup()}))}doWrite(e,t,s){const r=this,n="string"==typeof e,i={"Content-Type":n?"text/plain; charset=UTF-8":"application/octet-stream"};if(!this.httpCompression||!t.compress)return void c(e);if((n?Buffer.byteLength(e):e.length)<this.httpCompression.threshold)return void c(e);const a=o(this.req).encodings(["gzip","deflate"]);function c(e){i["Content-Length"]="string"==typeof e?Buffer.byteLength(e):e.length,r.res.writeHead(200,r.headers(r.req,i)),r.res.end(e),s()}a?this.compress(e,a,(function(e,t){if(e)return r.res.writeHead(500),r.res.end(),void s(e);i["Content-Encoding"]=a,c(t)})):c(e)}compress(e,t,s){a("compressing");const r=[];let n=0;c[t](this.httpCompression).on("error",s).on("data",(function(e){r.push(e),n+=e.length})).on("end",(function(){s(null,Buffer.concat(r,n))})).end(e)}doClose(e){a("closing");const t=this;let s;function r(){clearTimeout(s),e(),t.onClose()}this.dataReq&&(a("aborting ongoing data request"),this.dataReq.destroy()),this.writable?(a("transport writable - closing right away"),this.send([{type:"close"}]),r()):this.discarded?(a("transport discarded - closing right away"),r()):(a("transport not writable - buffering orderly close"),this.shouldClose=r,s=setTimeout(r,this.closeTimeout))}headers(e,t){t=t||{};const s=e.headers["user-agent"];return s&&(~s.indexOf(";MSIE")||~s.indexOf("Trident/"))&&(t["X-XSS-Protection"]="0"),this.emit("headers",t),t}}},1882:(e,t,s)=>{const r=s(4214),n=s(9743),i=s(3682)("engine:ws");e.exports=class extends r{constructor(e){super(e),this.socket=e.websocket,this.socket.on("message",this.onData.bind(this)),this.socket.once("close",this.onClose.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("headers",(e=>{this.emit("headers",e)})),this.writable=!0,this.perMessageDeflate=null}get name(){return"websocket"}get handlesUpgrades(){return!0}get supportsFraming(){return!0}onData(e){i('received "%s"',e),super.onData(e)}send(e){for(var t=this,s=0;s<e.length;s++){var r=e[s];n.encodePacket(r,t.supportsBinary,o)}function o(e){i('writing "%s"',e);var s={};r.options&&(s.compress=r.options.compress),t.perMessageDeflate&&("string"==typeof e?Buffer.byteLength(e):e.length)<t.perMessageDeflate.threshold&&(s.compress=!1),t.writable=!1,t.socket.send(e,s,a)}function a(e){if(e)return t.onError("write error",e.stack);t.writable=!0,t.emit("drain")}}doClose(e){i("closing"),this.socket.close(),e&&e()}}},7854:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=7854,e.exports=t},7840:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Adapter=void 0;const r=s(8614);class n extends r.EventEmitter{constructor(e){super(),this.nsp=e,this.rooms=new Map,this.sids=new Map,this.encoder=e.server.encoder}init(){}close(){}addAll(e,t){for(const s of t)this.sids.has(e)||this.sids.set(e,new Set),this.sids.get(e).add(s),this.rooms.has(s)||this.rooms.set(s,new Set),this.rooms.get(s).add(e)}del(e,t){this.sids.has(e)&&this.sids.get(e).delete(t),this.rooms.has(t)&&(this.rooms.get(t).delete(e),0===this.rooms.get(t).size&&this.rooms.delete(t))}delAll(e){if(this.sids.has(e)){for(const t of this.sids.get(e))this.rooms.has(t)&&(this.rooms.get(t).delete(e),0===this.rooms.get(t).size&&this.rooms.delete(t));this.sids.delete(e)}}broadcast(e,t){const s=t.rooms,r=t.except||new Set,n=t.flags||{},i={preEncoded:!0,volatile:n.volatile,compress:n.compress},o=new Set;e.nsp=this.nsp.name;const a=this.encoder.encode(e);if(s.size){for(const e of s)if(this.rooms.has(e))for(const t of this.rooms.get(e)){if(o.has(t)||r.has(t))continue;const e=this.nsp.sockets.get(t);e&&(e.packet(a,i),o.add(t))}}else for(const[e]of this.sids){if(r.has(e))continue;const t=this.nsp.sockets.get(e);t&&t.packet(a,i)}}sockets(e){const t=new Set;if(e.size){for(const s of e)if(this.rooms.has(s))for(const e of this.rooms.get(s))this.nsp.sockets.has(e)&&t.add(e)}else for(const[e]of this.sids)this.nsp.sockets.has(e)&&t.add(e);return Promise.resolve(t)}socketRooms(e){return this.sids.get(e)}}t.Adapter=n},7719:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructPacket=t.deconstructPacket=void 0;const r=s(2986);function n(e,t){if(!e)return e;if(r.isBinary(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let r=0;r<e.length;r++)s[r]=n(e[r],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const r in e)e.hasOwnProperty(r)&&(s[r]=n(e[r],t));return s}return e}function i(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=i(e[s],t);else if("object"==typeof e)for(const s in e)e.hasOwnProperty(s)&&(e[s]=i(e[s],t));return e}t.deconstructPacket=function(e){const t=[],s=e.data,r=e;return r.data=n(s,t),r.attachments=t.length,{packet:r,buffers:t}},t.reconstructPacket=function(e,t){return e.data=i(e.data,t),e.attachments=void 0,e}},5485:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=t.Encoder=t.PacketType=t.protocol=void 0;const r=s(722),n=s(7719),i=s(2986),o=s(3682)("socket.io-parser");var a;t.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(a=t.PacketType||(t.PacketType={})),t.Encoder=class{encode(e){return o("encoding packet %j",e),e.type!==a.EVENT&&e.type!==a.ACK||!i.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==a.BINARY_EVENT&&e.type!==a.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),o("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=n.deconstructPacket(e),s=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(s),r}};class c extends r{constructor(){super()}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===a.BINARY_EVENT||t.type===a.BINARY_ACK?(this.reconstructor=new h(t),0===t.attachments&&super.emit("decoded",t)):super.emit("decoded",t);else{if(!i.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emit("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===a[s.type])throw new Error("unknown packet type "+s.type);if(s.type===a.BINARY_EVENT||s.type===a.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const n=e.substring(r,t);if(n!=Number(n)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(n)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);s.nsp=e.substring(r,t)}else s.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!c.isPayloadValid(s.type,r))throw new Error("invalid payload");s.data=r}return o("decoded %s as %j",e,s),s}static isPayloadValid(e,t){switch(e){case a.CONNECT:return"object"==typeof t;case a.DISCONNECT:return void 0===t;case a.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case a.EVENT:case a.BINARY_EVENT:return Array.isArray(t)&&"string"==typeof t[0];case a.ACK:case a.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}t.Decoder=c;class h{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=n.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},2986:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasBinary=t.isBinary=void 0;const s="function"==typeof ArrayBuffer,r=Object.prototype.toString,n="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),i="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);function o(e){return s&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||n&&e instanceof Blob||i&&e instanceof File}t.isBinary=o,t.hasBinary=function e(t,s){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let s=0,r=t.length;s<r;s++)if(e(t[s]))return!0;return!1}if(o(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return!0;return!1}},2783:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=s(5485),n=s(3682)("socket.io:client");t.Client=class{constructor(e,t){this.sockets=new Map,this.nsps=new Map,this.server=e,this.conn=t,this.encoder=e.encoder,this.decoder=new e._parser.Decoder,this.id=t.id,this.setup()}get request(){return this.conn.request}setup(){this.onclose=this.onclose.bind(this),this.ondata=this.ondata.bind(this),this.onerror=this.onerror.bind(this),this.ondecoded=this.ondecoded.bind(this),this.decoder.on("decoded",this.ondecoded),this.conn.on("data",this.ondata),this.conn.on("error",this.onerror),this.conn.on("close",this.onclose),this.connectTimeout=setTimeout((()=>{0===this.nsps.size?(n("no namespace joined yet, close the client"),this.close()):n("the client has already joined a namespace, nothing to do")}),this.server._connectTimeout)}connect(e,t={}){if(this.server._nsps.has(e))return n("connecting to namespace %s",e),this.doConnect(e,t);this.server._checkNamespace(e,t,(s=>{s?(n("dynamic namespace %s was created",s.name),this.doConnect(e,t)):(n("creation of namespace %s was denied",e),this._packet({type:r.PacketType.CONNECT_ERROR,nsp:e,data:{message:"Invalid namespace"}}))}))}doConnect(e,t){this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=null);const s=this.server.of(e),r=s._add(this,t,(()=>{this.sockets.set(r.id,r),this.nsps.set(s.name,r)}))}_disconnect(){for(const e of this.sockets.values())e.disconnect();this.sockets.clear(),this.close()}_remove(e){if(this.sockets.has(e.id)){const t=this.sockets.get(e.id).nsp.name;this.sockets.delete(e.id),this.nsps.delete(t)}else n("ignoring remove for %s",e.id)}close(){"open"==this.conn.readyState&&(n("forcing transport close"),this.conn.close(),this.onclose("forced server close"))}_packet(e,t){t=t||{};const s=this;function r(e){if(!t.volatile||s.conn.transport.writable)for(let r=0;r<e.length;r++)s.conn.write(e[r],{compress:t.compress})}"open"==this.conn.readyState?(n("writing packet %j",e),t.preEncoded?r(e):r(this.encoder.encode(e))):n("ignoring packet write %j",e)}ondata(e){try{this.decoder.add(e)}catch(e){this.onerror(e)}}ondecoded(e){if(r.PacketType.CONNECT==e.type)this.connect(e.nsp,e.data);else{const t=this.nsps.get(e.nsp);t?process.nextTick((function(){t._onpacket(e)})):n("no socket for namespace %s",e.nsp)}}onerror(e){for(const t of this.sockets.values())t._onerror(e);this.conn.close()}onclose(e){n("client close with reason %s",e),this.destroy();for(const t of this.sockets.values())t._onclose(e);this.sockets.clear(),this.decoder.destroy()}destroy(){this.conn.removeListener("data",this.ondata),this.conn.removeListener("error",this.onerror),this.conn.removeListener("close",this.onclose),this.decoder.removeListener("decoded",this.ondecoded)}}},2730:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Namespace=t.Socket=t.Server=void 0;const a=s(8605),c=s(5747),h=s(8761),u=s(9413),l=s(2413),d=s(5622),p=s(2731),f=s(2783),g=s(8614),m=s(1984);Object.defineProperty(t,"Namespace",{enumerable:!0,get:function(){return m.Namespace}});const y=s(1255),v=s(7840),k=i(s(5485)),b=o(s(3682)),_=s(7121);Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return _.Socket}});const w=b.default("socket.io:server"),T=s(7865).i8,E=/\.map/;class C extends g.EventEmitter{constructor(e,t={}){super(),this._nsps=new Map,this.parentNsps=new Map,"object"==typeof e&&e instanceof Object&&!e.listen&&(t=e,e=null),this.path(t.path||"/socket.io"),this.connectTimeout(t.connectTimeout||45e3),this.serveClient(!1!==t.serveClient),this._parser=t.parser||k,this.encoder=new this._parser.Encoder,this.adapter(t.adapter||v.Adapter),this.sockets=this.of("/"),this.opts=t,e&&this.attach(e)}serveClient(e){return arguments.length?(this._serveClient=e,this):this._serveClient}_checkNamespace(e,t,s){if(0===this.parentNsps.size)return s(!1);const r=this.parentNsps.keys(),n=()=>{let i=r.next();if(i.done)return s(!1);i.value(e,t,((t,r)=>{t||!r?n():s(this.parentNsps.get(i.value).createChild(e))}))};n()}path(e){if(!arguments.length)return this._path;this._path=e.replace(/\/$/,"");const t=this._path.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");return this.clientPathRegex=new RegExp("^"+t+"/socket\\.io(\\.min|\\.msgpack\\.min)?\\.js(\\.map)?$"),this}connectTimeout(e){return void 0===e?this._connectTimeout:(this._connectTimeout=e,this)}adapter(e){if(!arguments.length)return this._adapter;this._adapter=e;for(const e of this._nsps.values())e._initAdapter();return this}listen(e,t={}){return this.attach(e,t)}attach(e,t={}){if("function"==typeof e)throw new Error("You are trying to attach socket.io to an express request handler function. Please pass a http.Server instance.");if(Number(e)==e&&(e=Number(e)),"number"==typeof e){w("creating http server and binding to %d",e);const t=e;(e=a.createServer(((e,t)=>{t.writeHead(404),t.end()}))).listen(t)}return Object.assign(t,this.opts),t.path=t.path||this._path,this.initEngine(e,t),this}initEngine(e,t){w("creating engine.io instance with opts %j",t),this.eio=p.attach(e,t),this._serveClient&&this.attachServe(e),this.httpServer=e,this.bind(this.eio)}attachServe(e){w("attaching client serving req handler");const t=e.listeners("request").slice(0);e.removeAllListeners("request"),e.on("request",((s,r)=>{if(this.clientPathRegex.test(s.url))this.serve(s,r);else for(let n=0;n<t.length;n++)t[n].call(e,s,r)}))}serve(e,t){const s=e.url.replace(this._path,""),r=E.test(s),n=r?"map":"source",i='"'+T+'"',o=e.headers["if-none-match"];if(o&&i==o)return w("serve client %s 304",n),t.writeHead(304),void t.end();w("serve client %s",n),t.setHeader("Cache-Control","public, max-age=0"),t.setHeader("Content-Type","application/"+(r?"json":"javascript")),t.setHeader("ETag",i),r||t.setHeader("X-SourceMap",s.substring(1)+".map"),C.sendFile(s,e,t)}static sendFile(e,t,s){const r=c.createReadStream(d.join(__dirname,"../client-dist/",e)),n=e=>{e&&s.end()};switch(u(t).encodings(["br","gzip","deflate"])){case"br":s.writeHead(200,{"content-encoding":"br"}),r.pipe(h.createBrotliCompress()).pipe(s),l.pipeline(r,h.createBrotliCompress(),s,n);break;case"gzip":s.writeHead(200,{"content-encoding":"gzip"}),l.pipeline(r,h.createGzip(),s,n);break;case"deflate":s.writeHead(200,{"content-encoding":"deflate"}),l.pipeline(r,h.createDeflate(),s,n);break;default:s.writeHead(200),l.pipeline(r,s,n)}}bind(e){return this.engine=e,this.engine.on("connection",this.onconnection.bind(this)),this}onconnection(e){return w("incoming connection with id %s",e.id),new f.Client(this,e),this}of(e,t){if("function"==typeof e||e instanceof RegExp){const s=new y.ParentNamespace(this);return w("initializing parent namespace %s",s.name),"function"==typeof e?this.parentNsps.set(e,s):this.parentNsps.set(((t,s,r)=>r(null,e.test(t))),s),t&&s.on("connect",t),s}"/"!==String(e)[0]&&(e="/"+e);let s=this._nsps.get(e);return s||(w("initializing namespace %s",e),s=new m.Namespace(this,e),this._nsps.set(e,s)),t&&s.on("connect",t),s}close(e){for(const e of this.sockets.sockets.values())e._onclose("server shutting down");this.engine.close(),this.httpServer?this.httpServer.close(e):e&&e()}use(e){return this.sockets.use(e),this}to(e){return this.sockets.to(e),this}in(e){return this.sockets.in(e),this}send(...e){return e.unshift("message"),this.sockets.emit.apply(this.sockets,e),this}write(...e){return e.unshift("message"),this.sockets.emit.apply(this.sockets,e),this}allSockets(){return this.sockets.allSockets()}compress(e){return this.sockets.compress(e),this}get volatile(){return this.sockets.volatile,this}get local(){return this.sockets.local,this}}t.Server=C,Object.keys(g.EventEmitter.prototype).filter((function(e){return"function"==typeof g.EventEmitter.prototype[e]})).forEach((function(e){C.prototype[e]=function(){return this.sockets[e].apply(this.sockets,arguments)}})),e.exports=(e,t)=>new C(e,t),e.exports.Server=C},1984:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Namespace=void 0;const n=s(7121),i=s(8614),o=s(5485),a=r(s(3682)).default("socket.io:namespace");class c extends i.EventEmitter{constructor(e,t){super(),this.sockets=new Map,this._fns=[],this._rooms=new Set,this._flags={},this._ids=0,this.server=e,this.name=t,this._initAdapter()}_initAdapter(){this.adapter=new(this.server.adapter())(this)}use(e){return this._fns.push(e),this}run(e,t){const s=this._fns.slice(0);if(!s.length)return t(null);!function r(n){s[n](e,(function(e){return e?t(e):s[n+1]?void r(n+1):t(null)}))}(0)}to(e){return this._rooms.add(e),this}in(e){return this._rooms.add(e),this}_add(e,t,s){a("adding socket to nsp %s",this.name);const r=new n.Socket(this,e,t);return this.run(r,(t=>{process.nextTick((()=>{if("open"==e.conn.readyState){if(t)return r._error({message:t.message,data:t.data});this.sockets.set(r.id,r),r._onconnect(),s&&s(),super.emit("connect",r),super.emit("connection",r)}else a("next called after client was closed - ignoring socket")}))})),r}_remove(e){this.sockets.has(e.id)?this.sockets.delete(e.id):a("ignoring remove for %s",e.id)}emit(e,...t){if(n.RESERVED_EVENTS.has(e))throw new Error(`"${e}" is a reserved event name`);t.unshift(e);const s={type:o.PacketType.EVENT,data:t};if("function"==typeof t[t.length-1])throw new Error("Callbacks are not supported when broadcasting");const r=new Set(this._rooms),i=Object.assign({},this._flags);return this._rooms.clear(),this._flags={},this.adapter.broadcast(s,{rooms:r,flags:i}),!0}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}write(...e){return e.unshift("message"),this.emit.apply(this,e),this}allSockets(){if(!this.adapter)throw new Error("No adapter for this namespace, are you trying to get the list of clients of a dynamic namespace?");const e=new Set(this._rooms);return this._rooms.clear(),this.adapter.sockets(e)}compress(e){return this._flags.compress=e,this}get volatile(){return this._flags.volatile=!0,this}get local(){return this._flags.local=!0,this}}t.Namespace=c},1255:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParentNamespace=void 0;const r=s(1984);class n extends r.Namespace{constructor(e){super(e,"/_"+n.count++),this.children=new Set}_initAdapter(){}emit(...e){return this.children.forEach((t=>{t._rooms=this._rooms,t._flags=this._flags,t.emit.apply(t,e)})),this._rooms.clear(),this._flags={},!0}createChild(e){const t=new r.Namespace(this.server,e);return t._fns=this._fns.slice(0),this.listeners("connect").forEach((e=>t.on("connect",e))),this.listeners("connection").forEach((e=>t.on("connection",e))),this.children.add(t),this.server._nsps.set(e,t),t}}t.ParentNamespace=n,n.count=0},7121:function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=t.RESERVED_EVENTS=void 0;const n=s(8614),i=s(5485),o=s(8835),a=r(s(3682)),c=r(s(8209)),h=a.default("socket.io:socket");t.RESERVED_EVENTS=new Set(["connect","connect_error","disconnect","disconnecting","newListener","removeListener"]);class u extends n.EventEmitter{constructor(e,t,s){super(),this.nsp=e,this.client=t,this.acks=new Map,this.fns=[],this.flags={},this._rooms=new Set,this.server=e.server,this.adapter=this.nsp.adapter,this.id=c.default.generateId(),this.connected=!0,this.disconnected=!1,this.handshake=this.buildHandshake(s)}buildHandshake(e){return{headers:this.request.headers,time:new Date+"",address:this.conn.remoteAddress,xdomain:!!this.request.headers.origin,secure:!!this.request.connection.encrypted,issued:+new Date,url:this.request.url,query:o.parse(this.request.url,!0).query,auth:e}}emit(e,...s){if(t.RESERVED_EVENTS.has(e))throw new Error(`"${e}" is a reserved event name`);s.unshift(e);const r={type:i.PacketType.EVENT,data:s};if("function"==typeof s[s.length-1]){if(this._rooms.size||this.flags.broadcast)throw new Error("Callbacks are not supported when broadcasting");h("emitting packet with ack id %d",this.nsp._ids),this.acks.set(this.nsp._ids,s.pop()),r.id=this.nsp._ids++}const n=new Set(this._rooms),o=Object.assign({},this.flags);return this._rooms.clear(),this.flags={},n.size||o.broadcast?this.adapter.broadcast(r,{except:new Set([this.id]),rooms:n,flags:o}):this.packet(r,o),!0}to(e){return this._rooms.add(e),this}in(e){return this._rooms.add(e),this}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}write(...e){return e.unshift("message"),this.emit.apply(this,e),this}packet(e,t={}){e.nsp=this.nsp.name,t.compress=!1!==t.compress,this.client._packet(e,t)}join(e){return h("join room %s",e),this.adapter.addAll(this.id,new Set(Array.isArray(e)?e:[e]))}leave(e){return h("leave room %s",e),this.adapter.del(this.id,e)}leaveAll(){this.adapter.delAll(this.id)}_onconnect(){h("socket connected - writing packet"),this.join(this.id),this.packet({type:i.PacketType.CONNECT,data:{sid:this.id}})}_onpacket(e){switch(h("got packet %j",e),e.type){case i.PacketType.EVENT:case i.PacketType.BINARY_EVENT:this.onevent(e);break;case i.PacketType.ACK:case i.PacketType.BINARY_ACK:this.onack(e);break;case i.PacketType.DISCONNECT:this.ondisconnect();break;case i.PacketType.CONNECT_ERROR:this._onerror(new Error(e.data))}}onevent(e){const t=e.data||[];if(h("emitting event %j",t),null!=e.id&&(h("attaching ack callback to event"),t.push(this.ack(e.id))),this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t)}ack(e){const t=this;let s=!1;return function(){if(s)return;const r=Array.prototype.slice.call(arguments);h("sending ack %j",r),t.packet({id:e,type:i.PacketType.ACK,data:r}),s=!0}}onack(e){const t=this.acks.get(e.id);"function"==typeof t?(h("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),this.acks.delete(e.id)):h("bad ack %s",e.id)}ondisconnect(){h("got disconnect packet"),this._onclose("client namespace disconnect")}_onerror(e){this.listeners("error").length?super.emit("error",e):(console.error("Missing error handler on `socket`."),console.error(e.stack))}_onclose(e){if(!this.connected)return this;h("closing socket - reason %s",e),super.emit("disconnecting",e),this.leaveAll(),this.nsp._remove(this),this.client._remove(this),this.connected=!1,this.disconnected=!0,super.emit("disconnect",e)}_error(e){this.packet({type:i.PacketType.CONNECT_ERROR,data:e})}disconnect(e=!1){return this.connected?(e?this.client._disconnect():(this.packet({type:i.PacketType.DISCONNECT}),this._onclose("server namespace disconnect")),this):this}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}get broadcast(){return this.flags.broadcast=!0,this}get local(){return this.flags.local=!0,this}get request(){return this.client.request}get conn(){return this.client.conn}get rooms(){return this.adapter.socketRooms(this.id)||new Set}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}t.Socket=u},7865:e=>{"use strict";e.exports={i8:"3.0.3"}},8492:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s(3607).default()},5700:function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var s,r,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{s=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.chatExists=void 0;var i=s(3607),o=s(4278);function a(e){return r(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,o.Chat.findOne({room:e})];case 1:return[2,!!t.sent()]}}))}))}t.default=function(){i.appRouter.get("/:room",(function(e,t,s){return r(void 0,void 0,void 0,(function(){var r;return n(this,(function(n){try{if(!a(r=e.params.room))return[2,t.status(404).json({status:"fail",message:"The club "+r+" does not exist."})];o.Chat.find({room:r},(function(e,r){if(e)return s(e);t.json(r)}))}catch(e){t.status(500).json({error:e.message})}return[2]}))}))})),i.appRouter.get("/:id",(function(e,t,s){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){return o.Chat.findById(e.params.id,(function(e,r){if(e)return s(e);t.json(r)})),[2]}))}))})),i.appRouter.post("/",(function(e,t,s){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){return o.Chat.create(e.body,(function(e,r){if(e)return s(e);!function(e){i.io.emit("new-message",e)}(r),t.json(r)})),[2]}))}))})),i.appRouter.put("/:id",(function(e,t,s){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){return o.Chat.findByIdAndUpdate(e.params.id,e.body,(function(e,r){if(e)return s(e);t.json(r)})),[2]}))}))})),i.appRouter.delete("/:id",(function(e,t,s){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){return o.Chat.findByIdAndRemove(e.params.id,e.body,(function(e,r){if(e)return s(e);t.json(r)})),[2]}))}))}))},t.chatExists=a},2554:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(5700);t.default=[r.default]},395:function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var s,r,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{s=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=s(2554),o=s(6030),a=s(6645);t.default=function(){return r(void 0,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,o.default()];case 1:return e.sent(),i.default.forEach((function(e){e()})),a.success("API chargée"),[2]}}))}))}},6030:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.db=void 0;var r=s(5619),n=s(6645);function i(){r.connect(process.env.MONGO_URL,{useFindAndModify:!1,useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0})}t.default=function(){return new Promise((function(e,s){process.env.MONGO_URL||(n.error("Veuillez renseigner la variable d'environnement MONGO_URL et redémarrer le serveur."),process.exit(1)),r.Promise=global.Promise,t.db=r.connection,t.db.on("connecting",(function(){n.info("Connexion à MongoDB...")})),t.db.on("error",(function(e){n.error(e),r.disconnect()})),t.db.once("open",(function(){return n.success("Connecté à MongoDB !"),e()})),t.db.on("disconnected",(function(){setTimeout((function(){try{i()}catch(e){n.error("Impossible de se reconnecter à MongoDB : "+e)}}),5e3)})),i()}))}},3607:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.io=t.appRouter=void 0;var r=s(2127),n=s(2473),i=s(479);s(334).config();var o=s(395),a=s(6645),c=r();c.use(r.json()),c.use(i());var h=process.env.PORT||5e3;t.appRouter=r.Router(),c.use((function(e,t,s){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),s()})),c.use(t.appRouter),t.appRouter.use(n.urlencoded({extended:!0})),t.appRouter.use("/static",r.static("static"));var u=s(8605).createServer(c);t.io=s(2730)(u),t.default=function(){c.listen(h,(function(){a.success("Serveur démarré ! "+h),o.default()})),u.listen(4e3,(function(){console.log("listening on *:4000")}))}},4278:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=void 0;var r=s(5619),n=new r.Schema({room:String,nickname:String,message:String,updated_at:{type:Date,default:Date.now}});t.Chat=r.model("chat",n)},6645:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.info=t.success=void 0;var r=s(2242),n=s(2470);t.success=function(e){var t=n().format("HH:mm");console.log(r.green.bold(t+" : "+e))},t.info=function(e){var t=n().format("HH:mm");console.log(r.cyan(t+" : "+e))},t.error=function(e){var t=n().format("HH:mm");console.log(r.bold.red(t+" : "+e))}},9413:e=>{"use strict";e.exports=require("accepts")},8209:e=>{"use strict";e.exports=require("base64id")},2473:e=>{"use strict";e.exports=require("body-parser")},2242:e=>{"use strict";e.exports=require("chalk")},722:e=>{"use strict";e.exports=require("component-emitter")},8883:e=>{"use strict";e.exports=require("cookie")},479:e=>{"use strict";e.exports=require("cors")},3682:e=>{"use strict";e.exports=require("debug")},334:e=>{"use strict";e.exports=require("dotenv")},8614:e=>{"use strict";e.exports=require("events")},2127:e=>{"use strict";e.exports=require("express")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},2470:e=>{"use strict";e.exports=require("moment")},5619:e=>{"use strict";e.exports=require("mongoose")},5622:e=>{"use strict";e.exports=require("path")},1191:e=>{"use strict";e.exports=require("querystring")},2413:e=>{"use strict";e.exports=require("stream")},8835:e=>{"use strict";e.exports=require("url")},2439:e=>{"use strict";e.exports=require("ws")},8761:e=>{"use strict";e.exports=require("zlib")}},t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,s),n.exports}return s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s(8492)})());